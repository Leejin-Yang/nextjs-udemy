# 페이지 사전 렌더링 & 데이터 페칭

## React와 Nextjs 비교

### React 앱의 문제점

fetch한 데이터는 js 코드에 데이터를 로딩한 것이 아니다. 파일을 import하는 방식이 아니다. 대신 설정이 모두 끝나고 브라우저에서 실행되고 있을 때 해당 파일에 HTTP 요청을 보내는 방식이다. 그 후 추출한 데이터를 로딩하고 상태 설정과 데이터 렌더링을 시작한다. **\*\***렌더링된 DOM에서는 표시가 되는데 이는 JS와 React를 통한 렌더링이 끝나야지만 본 페이지에서 로딩된다.

**_페이지 소스를 보면 어디에서도 데이터를 찾아볼 수 없다._**

이는 몇 가지 단점이 있는데 사용자들이 데이터가 실질적으로 페이지에 로딩되기까지 기다려야한다. 이렇게 데이터를 페칭하면 사용자 경험의 최적화라고 할 수 없다. 괜찮을 수도 있겠지만 더 나아질 여지가 있는 것이다.

검색 엔진 최적화에도 문제가 있다. 콘텐츠를 구글이 알아야하는데 검색 엔진은 콘텐츠가 없는 데이터를 보게 된다. 재전송 방식은 적합하지 않다. 검색엔진이 상관 없다면(대시보드나 로그인) 괜찮지만 콘텐츠가 많은 앱의 경우 필요하다.

### Nextjs

pre-rendering 개념을 이용해서 위와 같은 문제의 해결을 돕는다.

사용자가 페이지를 방문해 요청이 전송되면 Nextjs가 pre-render된 페이지를 반환한다. 페이지를 다시 클라이언트로 전송된 뒤에만 데이터를 로딩하는 대신 필요할 법한 모든 데이터가 있는 HTML 콘텐츠를 사전에 렌더링한다. 사전에 HTML 페이지를 완성해 놓고 완전히 채워진 HTML 파일을 클라이언트에게 전송한다. SEO에도 뛰어나다!

하지만 Interactive React 앱이 필요하다. 사용자와 상호작용하기 위해서. Nextjs는 단순히 pre-rendering된 페이지를 재전송하는데 그치지 않고 포함된 js 코드를 모두 재전송한다. 이런 재전송을 해당 페이지에 대해 hydrate한다고 한다. 재전송된 js코드는 나중에 pre-rendering된 페이지를 대체하고 이에 React가 알맞은 작업을 수행한다.

주요 콘텐츠가 모두 포함되어 있는 상태이기 때문에 검색엔진크롤러도 모든 콘텐츠를 살펴보게 된다.

요약하면 Nextjs는 페이지를 사전에 준비하는데 이때 모든 HTML 콘텐츠를 사전에 구축하고 필요할 모든 데이터릴 사전에 로딩하는 방식을 따른다. **_사전 렌더링은 오직 최초 로딩할 때만 영향을 미친다._** 페이지를 방문하면 로딩되는 첫 번째 페이지가 pre-rendering 된 것이다. 첫 번째 렌더링이 끝나고 나면 다시 SPA로 돌아간다. 그때부터 React가 프론트엔드에서 모든 처리를 수행한다. 그 후에 페이지가 바뀔 때 해당 페이지가 pre-rendering되지 않고 React를 통해 클라이언트 사이드에서 생성된다. pre-rendering되는 건 최초 접속하는 첫 번째 페이지 뿐!

Nextjs에는 두 가지 pre-rendering 양식이 있다.

- Static Generation (정적 생성)
- Server-side Rendering

둘의 차이점은 정적 생성은 빌드되는 동안 모든 페이지가 사전 생성된다는 것이다. 따라서 프로덕션용 앱을 구축한다면 배포 전에 모든 페이지가 준비된다는 것. SSR의 경우 배포 후 요청이 서버까지 오는 바로 그때 모든 페이지가 생성된다.
